@use '../../global/styles' as sbb;
@use 'node_modules/@sbb-esta/lyne-design-tokens/dist/scss/sbb-variables.scss' as sbb-tokens;

// Default component properties, defined for :host. Properties which can not
// travel the shadow boundary are defined through this mixin
@include sbb.host-component-properties;

:host {
  --sbb-notification-visibility: hidden;
  --sbb-notification-opacity: 0;
  --sbb-notification-max-height: 0;
  --sbb-notification-margin: 0;
  --sbb-notification-padding-block: var(--sbb-spacing-responsive-xxs);
  --sbb-notification-padding-inline: var(--sbb-spacing-responsive-xs);
  --sbb-notification-color: var(--sbb-color-charcoal-default);
  --sbb-notification-type-color: var(--sbb-color-granite-default);
  --sbb-notification-border-width: var(--sbb-border-width-1x);
  --sbb-notification-border: var(--sbb-border-width-1x) solid var(--sbb-notification-type-color);
  --sbb-notification-border-radius: var(--sbb-border-radius-2x) var(--sbb-border-radius-4x)
    var(--sbb-border-radius-4x) var(--sbb-border-radius-2x);
  --sbb-notification-animation-duration: var(--sbb-animation-duration-4x);
  --sbb-notification-timing-function: ease-in;
  --sbb-notification-transition: max-height var(--sbb-notification-animation-duration)
      var(--sbb-animation-duration-2x) var(--sbb-notification-timing-function),
    padding var(--sbb-notification-animation-duration) var(--sbb-animation-duration-2x)
      var(--sbb-notification-timing-function),
    border var(--sbb-notification-animation-duration) var(--sbb-animation-duration-2x)
      var(--sbb-notification-timing-function),
    visibility var(--sbb-notification-animation-duration) var(--sbb-notification-timing-function),
    opacity var(--sbb-notification-animation-duration) var(--sbb-notification-timing-function);

  margin: 0;
  transition: margin var(--sbb-notification-animation-duration)
    var(--sbb-notification-timing-function);
}

:host(:is([data-state='opened'], [data-state='opening'])) {
  --sbb-notification-visibility: visible;
  --sbb-notification-opacity: 1;
  --sbb-notification-max-height: var(--sbb-notification-height);
  --sbb-notification-transition: max-height var(--sbb-notification-animation-duration)
      var(--sbb-notification-timing-function),
    padding var(--sbb-notification-animation-duration) var(--sbb-notification-timing-function),
    border var(--sbb-notification-animation-duration) var(--sbb-notification-timing-function),
    opacity var(--sbb-notification-animation-duration) var(--sbb-notification-animation-duration)
      var(--sbb-notification-timing-function);

  margin: var(--sbb-notification-margin);
}

:host(
    :is(
        [data-resize-disable-animation='true'],
        [disable-animation]:not([disable-animation='false'])
      )
  ) {
  --sbb-notification-animation-duration: 0s;
}

/* Types */

$types: (
  'info': sbb-tokens.$sbb-color-granite-default,
  'success': sbb-tokens.$sbb-color-green-default,
  'warn': sbb-tokens.$sbb-color-peach-default,
  'error': sbb-tokens.$sbb-color-red-default,
);

:host([type='info']) {
  --sbb-notification-type-color: var(--sbb-color-granite-default);
}

:host([type='success']) {
  --sbb-notification-type-color: var(--sbb-color-green-default);
}

:host([type='warn']) {
  --sbb-notification-type-color: var(--sbb-color-peach-default);
}

:host([type='error']) {
  --sbb-notification-type-color: var(--sbb-color-red-default);
}

.sbb-notification__wrapper {
  position: relative;
  inset-inline-start: calc(var(--sbb-border-radius-4x) - var(--sbb-border-width-1x));
  width: calc(100% - calc(var(--sbb-border-radius-4x) - var(--sbb-border-width-1x)));
  visibility: var(--sbb-notification-visibility);
  opacity: var(--sbb-notification-opacity);
  max-height: var(--sbb-notification-max-height);
  transition: var(--sbb-notification-transition);
  border: var(--sbb-notification-border);
  border-radius: var(--sbb-notification-border-radius);
  animation: {
    name: open;
    duration: var(--sbb-notification-animation-duration);
    timing-function: var(--sbb-notification-timing-function);
  }

  &::before {
    content: '';
    position: absolute;
    inset: calc(var(--sbb-border-width-1x) * -1) var(--sbb-border-radius-4x)
      calc(var(--sbb-border-width-1x) * -1) calc(var(--sbb-border-radius-4x) * -1);
    background-color: var(--sbb-notification-type-color);
    border: var(--sbb-notification-border);
    border-radius: var(--sbb-border-radius-4x);
    z-index: -1;
  }
}

.sbb-notification {
  @include sbb.text-s--regular;

  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  padding-block: var(--sbb-notification-padding-block);
  padding-inline: var(--sbb-notification-padding-inline);
  color: var(--sbb-notification-color);
  border-radius: var(--sbb-notification-border-radius);
  overflow: hidden;

  @each $key, $value in $types {
    :host([type='#{$key}']) & {
      background-color: rgba($color: $value, $alpha: 5%);

      @supports (
        background-color: color-mix(in srgb, var(--sbb-notification-type-color) 5%, white)
      ) {
        background-color: color-mix(in srgb, var(--sbb-notification-type-color) 5%, white);
      }
    }
  }

  @include sbb.mq($from: small) {
    grid-template-columns: auto 1fr auto;
    align-items: flex-start;
  }
}

.sbb-notification__icon {
  margin-block: var(--sbb-spacing-fixed-2x);
  color: var(--sbb-notification-type-color);

  :host([type='warn']) & {
    color: var(--sbb-notification-color);
  }

  @include sbb.mq($from: small) {
    margin-block-end: 0;
    margin-block-start: calc(
      (
          (var(--sbb-typo-scale-default) * var(--sbb-typo-line-height-body-text)) -
            var(--sbb-size-icon-ui-small)
        ) / 2
    );

    :host([data-has-title]) & {
      margin-block-start: calc(
        (
            (var(--sbb-font-size-title-5) * var(--sbb-typo-line-height-body-text)) -
              var(--sbb-size-icon-ui-small)
          ) / 2
      );
    }
  }
}

.sbb-notification__title {
  // Overwrite sbb-title default margin
  margin: 0;
}

.sbb-notification__content {
  order: 3;
  grid-area: 2 / 1 / 3 / 3;

  @include sbb.mq($from: small) {
    order: initial;
    grid-area: initial;
    padding-inline: var(--sbb-spacing-responsive-xxxs) var(--sbb-spacing-responsive-xs);
  }
}

.sbb-notification__close-wrapper {
  display: flex;
  align-items: center;
  height: 100%;
  gap: var(--sbb-spacing-responsive-xxs);
  max-height: calc(var(--sbb-size-icon-ui-small) + var(--sbb-spacing-fixed-4x));

  @include sbb.mq($from: small) {
    max-height: 100%;
  }
}

.sbb-notification__divider {
  --sbb-divider-color: var(--sbb-notification-type-color);

  display: none;
  position: relative;
  inset-inline-start: var(--sbb-border-width-1x);
  opacity: 0.2;
  height: calc(var(--sbb-size-icon-ui-small) + var(--sbb-spacing-fixed-1x));

  @include sbb.mq($from: small) {
    display: block;
    height: calc(100% - #{sbb.px-to-rem-build(12)});
  }
}

@keyframes open {
  from {
    visibility: hidden;
    opacity: 0;
    max-height: 0;
  }

  to {
    visibility: visible;
    opacity: 1;
    max-height: var(--sbb-notification-height);
  }
}
