@use '../../global/styles' as sbb;

// Default component properties, defined for :host. Properties which can not
// travel the shadow boundary are defined through this mixin
@include sbb.host-component-properties;

:host {
  @include sbb.pearl-chain-dot-variables;

  display: block;

  --sbb-pearl-chain-dot-size-medium: var(--sbb-pearl-chain-dot-size-m);
  --sbb-pearl-chain-dot-size-small: var(--sbb-pearl-chain-dot-size);
  --sbb-pearl-chain-height: var(--sbb-border-width-2x);
  --sbb-pearl-chain-spacing-small: var(--sbb-spacing-fixed-1x);
  --sbb-pearl-chain-color: var(--sbb-pearl-chain-dot-color);
  --sbb-pearl-chain-color-warning: var(--sbb-pearl-chain-dot-color-warning);
  --sbb-pearl-chain-color-past: var(--sbb-pearl-chain-dot-color-past);
  --sbb-pearl-chain-leg-width: 100%;
}

.sbb-pearl-chain {
  position: relative;
  display: flex;
  justify-content: space-between;
  flex-wrap: nowrap;
  color: var(--sbb-pearl-chain-color);
  width: 100%;
  padding-block-start: calc(
    (var(--sbb-pearl-chain-dot-size-medium) - var(--sbb-pearl-chain-height)) / 2
  );
  padding-block-end: calc(
    (var(--sbb-pearl-chain-dot-size-medium) - var(--sbb-pearl-chain-height)) / 2
  );
  padding-inline-end: var(--sbb-pearl-chain-dot-size-medium);
}

// first and last dot
.sbb-pearl-chain::before,
.sbb-pearl-chain::after {
  @include sbb.pearl-chain-dot;
  @include sbb.pearl-chain-dot--m;

  content: '';
  position: absolute;
  background-color: currentcolor;
  inset-block-start: 0;
  z-index: 3;

  @include sbb.if-forced-colors {
    background-color: CanvasText;
  }
}

.sbb-pearl-chain::before {
  inset-inline-start: 0;
}

.sbb-pearl-chain::after {
  inset-inline-end: 0;
}

.sbb-pearl-chain.sbb-pearl-chain--past::before,
.sbb-pearl-chain.sbb-pearl-chain--past::after {
  @include sbb.if-forced-colors {
    background-color: GrayText;
  }
}

.sbb-pearl-chain--departure-cancellation::before,
.sbb-pearl-chain--arrival-cancellation::after {
  color: var(--sbb-pearl-chain-color-warning);

  @include sbb.if-forced-colors {
    background-color: ActiveText;
  }
}

.sbb-pearl-chain--departure-cancellation.pearl-chain--past::before,
.sbb-pearl-chain--arrival-cancellation.pearl-chain--past::after {
  color: var(--sbb-pearl-chain-color-past);

  @include sbb.if-forced-colors {
    color: GrayText;
  }
}

.sbb-pearl-chain--past {
  position: relative;

  @include sbb.if-forced-colors {
    color: GrayText;
  }
}

.sbb-pearl-chain__leg {
  flex-shrink: 0;
  flex-grow: 0;
  position: relative;
  height: var(--sbb-pearl-chain-height);
  border-inline-end: var(--sbb-pearl-chain-spacing-small) solid Canvas;
  background-color: currentcolor;
  width: var(--sbb-pearl-chain-leg-width);

  @include sbb.if-forced-colors {
    color: CanvasText;
  }
}

.sbb-pearl-chain__leg:last-of-type {
  border: none;
}

.sbb-pearl-chain__leg--past,
.sbb-pearl-chain--past,
.sbb-pearl-chain__leg--progress::before,
.sbb-pearl-chain--progress::before {
  @include sbb.pearl-chain-dot-past;

  color: var(--sbb-pearl-chain-color-past);
}

.sbb-pearl-chain__leg--past:not(:first-child)::before,
.sbb-pearl-chain__leg--progress::before {
  @include sbb.pearl-chain-dot-past;
}

// dot on leg
.sbb-pearl-chain__leg:not(:first-child) {
  &::before {
    @include sbb.pearl-chain-dot-transfer;
    @include sbb.pearl-chain-dot--s;

    content: '';
    position: absolute;
    inset-block-start: calc(
      var(--sbb-pearl-chain-dot-size) / -2 + var(--sbb-pearl-chain-height) / 2
    );
    inset-inline-start: 0;
    z-index: 2;

    @include sbb.if-forced-colors {
      .sbb-pearl-chain--past & {
        border-color: GrayText;
      }
    }
  }
}

// line on leg
.sbb-pearl-chain__leg::after {
  content: '';
  position: absolute;
  inset-block-start: 0;
  inset-block-end: 0;
  inset-inline-start: 0;
  background-color: currentcolor;
  border-radius: var(--sbb-pearl-chain-height);
  z-index: 1;

  @include sbb.if-forced-colors {
    background-color: CanvasText;

    .sbb-pearl-chain--past & {
      background-color: GrayText;
    }
  }
}

.sbb-pearl-chain__leg:last-of-type::after {
  inset-inline-end: calc(-1 * var(--sbb-pearl-chain-height));
}

.sbb-pearl-chain__leg--progress::after {
  @include sbb.pearl-chain-dot-past;

  background-color: var(--sbb-pearl-chain-color-past);

  // --sbb-pearl-chain-leg-status: defined in .tsx file
  width: var(--sbb-pearl-chain-leg-status);
}

.sbb-pearl-chain__leg--cancellation {
  @include sbb.pearl-chain-dot-warning;

  color: var(--sbb-pearl-chain-color-warning);

  @include sbb.if-forced-colors {
    color: ActiveText;
  }
}

.sbb-pearl-chain__leg--cancellation::after {
  background-color: unset;
  background-image: linear-gradient(to right, currentcolor 0%, currentcolor 50%, Canvas 50%);
  background-repeat: repeat-x;
  background-size: calc(2 * var(--sbb-pearl-chain-spacing-small)) var(--sbb-pearl-chain-height);
  inset-inline-end: var(--sbb-pearl-chain-height);
}

.sbb-pearl-chain__leg--cancellation::after,
.sbb-pearl-chain--past .sbb-pearl-chain__leg--cancellation::after {
  @include sbb.if-forced-colors {
    background: none;
    border-block-start: #{sbb.px-to-rem-build(1)} dashed currentcolor;
    transform: translateY(#{sbb.px-to-rem-build(1)});
  }
}

.sbb-pearl-chain__position {
  @include sbb.pearl-chain-dot-position;
  @include sbb.pearl-chain-dot--m;

  position: absolute;
  inset-block-start: -200%;
  z-index: 4;

  // --sbb-pearl-chain-status-position: defined in .tsx file
  inset-inline-start: var(--sbb-pearl-chain-status-position);

  @include sbb.if-forced-colors {
    background-color: ActiveText;
  }
}

.sbb-pearl-chain__position--no-animation {
  animation: unset;
}
